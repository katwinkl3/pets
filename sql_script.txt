DROP TABLE if exists users cascade;
DROP TABLE if exists petowners cascade;
DROP TABLE if exists pets cascade;
DROP TABLE if exists homes cascade;
DROP TABLE if exists bid cascade;
DROP TABLE if exists history cascade;
DROP TABLE if exists caretaker cascade;
DROP TABLE if exists services cascade;
DROP TABLE if exists admins cascade;


CREATE TABLE admins (
	id 			SERIAL PRIMARY KEY
);

CREATE TABLE users (
	id 					SERIAL primary key,
	name 				text not null,
	email				VARCHAR(100) not null unique,
	password 			text not null,
	lastlogintimestamp	TIMESTAMP not null,
	unique(id,name)
);

CREATE TABLE petowners (
	oid				serial primary key,
	owner_name		text not null,
	description 	text not null,
	foreign key (oid, owner_name) references users(id,name)
);

CREATE TABLE caretaker (
	cid				SERIAL unique not null,
	name 			text not null,
	pet_type			text not null,
	pet_size			smallint not null,
	housing_options	smallint not null,
	misc_options		text,
	description 	text not null,
	num_of_pet		smallint not null, 
	-- address			text not null REFERENCES homes(address)
	foreign key (cid, name) references users(id, name)
);

CREATE TABLE pets (
	pet_id				SERIAL primary key,
	name				VARCHAR(100) not null,
	weight				smallint not null,
	age					smallint not null,
	breed				VARCHAR(100) not null,
	pet_type				VARCHAR(100) not null,
	gender				VARCHAR (100) not null, 
	description			text,
	medical_conditions	text,
	oid					SERIAL not null REFERENCES petowners(oid)
);

CREATE TABLE homes (
	address			text not null,
	area			integer not null,
	type 			text not null,
	home_owner		SERIAL not null REFERENCES users(id),
	primary key (address, home_owner)
);

CREATE TABLE services (
	Service 		VARCHAR(100) not null,
	StartDate 		DATE not null,
	EndDate 		DATE not null,
	Rate			smallint not null,
	cid				SERIAL not null REFERENCES caretaker(cid),
	serviceid		serial primary key,
	unique(cid, serviceid)
);

set datestyle = 'DMY';

CREATE TABLE bid (
	ServiceStartDate	date not null,
	ServiceEndDate		date not null,
	BidID			SERIAL primary key,
	BidTimestamp	timestamp not null ,
	BidAmount		smallint not null,
	pet_id 			SERIAL not null REFERENCES pets(pet_id),
	PetOwnerID		SERIAL not null REFERENCES petowners(oid),
	CareTakerID		SERIAL not null REFERENCES caretaker(cid),
	ServiceID		serial not null REFERENCES services(serviceid),
	bidrequest		text,
	bidstatus		varchar(20) default 'pending' not null 
);

CREATE Table History (
	BookingID		SERIAL primary key,
	BidderID		SERIAL not null REFERENCES caretaker(cid),
	PetOnwner 		SERIAL not null REFERENCES petowners(oid),
	PetID 			SERIAL not null REFERENCES pets(pet_id),
	--BookingTimestamp	timestamp not null references Bid(BidTimestamp),
	-- PaymentID		SERIAL not null REFERENCES Payment(PaymentID),
	serviceid 		serial not null REFERENCES services(serviceid)
);
